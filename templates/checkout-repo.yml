parameters:
  - name: path
    displayName: Path to clone repository
    type: string

steps:
    - bash: |
        if [ ! -d '${{ parameters.path }}' ] ; then
          B64_PAT=$(echo -n ':$(secret_git)' | base64)
          git config --global --add $(create_repo).extraHeader "Authorization: Basic ${B64_PAT}"
          git clone $(create_repo) ${{ parameters.path }}

          tree



          cd ${{ parameters.path }}
          git checkout $(default_branch) || git checkout -b $(default_branch)
        fi
      failOnStderr: false
      displayName: Checkout Existing Repository
      condition: and(succeeded(), ne(variables.create_repo, ''))
    - bash: |
        echo "TODO: created repo checkout"
        exit 1
      failOnStderr: true
      displayName: Checkout Created Repository
      condition: and(succeeded(), eq(variables.create_repo, ''))